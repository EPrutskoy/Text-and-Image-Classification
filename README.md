# Сборный проект-4 
# Text_and_Image_POC

**Идея PoC (Proof of Concept, Проверка концепции) проекта:**

Разработать демонстрационную версию сервиса поиска изображений по текстовым описаниям, 
которая будет использовать нейросетевые модели для оценки соответствия между текстом и изображением.


## Описание данных

Данные доступны по [ссылке](https://code.s3.yandex.net/datasets/dsplus_integrated_project_4.zip).

В файле `train_dataset.csv` находится информация, необходимая для обучения: имя файла изображения, идентификатор описания и текст описания. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `train_images` содержатся изображения для тренировки модели.

В файле `CrowdAnnotations.tsv` — данные по соответствию изображения и описания, полученные с помощью краудсорсинга. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.
3. Доля людей, подтвердивших, что описание соответствует изображению.
4. Количество человек, подтвердивших, что описание соответствует изображению.
5. Количество человек, подтвердивших, что описание не соответствует изображению.

В файле `ExpertAnnotations.tsv` содержатся данные по соответствию изображения и описания, полученные в результате опроса экспертов. Номера колонок и соответствующий тип данных:

1. Имя файла изображения.
2. Идентификатор описания.

3, 4, 5 — оценки трёх экспертов.

Наш датасет содержит экспертные и краудсорсинговые оценки соответствия текста и изображения.

В файле с экспертными мнениями для каждой пары изображение-текст имеются оценки от трёх специалистов. Для решения задачи вы должны эти оценки агрегировать — превратить в одну. Существует несколько способов агрегации оценок, самый простой — голосование большинства: за какую оценку проголосовала большая часть экспертов (в нашем случае 2 или 3), та оценка и ставится как итоговая. Поскольку число экспертов меньше числа классов, может случиться, что каждый эксперт поставит разные оценки, например: 1, 4, 2. В таком случае данную пару изображение-текст можно исключить из датасета.

Вы можете воспользоваться другим методом агрегации оценок или придумать свой.

В файле с краудсорсинговыми оценками информация расположена в таком порядке:

1. Доля исполнителей, подтвердивших, что текст **соответствует** картинке.
2. Количество исполнителей, подтвердивших, что текст **соответствует** картинке.
3. Количество исполнителей, подтвердивших, что текст **не соответствует** картинке.

После анализа экспертных и краудсорсинговых оценок выберите либо одну из них, либо объедините их в одну по какому-то критерию: например, оценка эксперта принимается с коэффициентом 0.6, а крауда — с коэффициентом 0.4.

Ваша модель должна возвращать на выходе вероятность соответствия изображения тексту, поэтому целевая переменная должна иметь значения от 0 до 1.

Эксперты ставят оценки по шкале от 1 до 4, где 1 — изображение и запрос совершенно не соответствуют друг другу, 2 — запрос содержит элементы описания изображения, но в целом запрос тексту не соответствует, 3 — запрос и текст соответствуют с точностью до некоторых деталей, 4 — запрос и текст соответствуют полностью.

В файле `test_queries.csv` находится информация, необходимая для тестирования: идентификатор запроса, текст запроса и релевантное изображение. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат `<имя файла изображения>#<порядковый номер описания>`.

В папке `test_images` содержатся изображения для тестирования модели.\
\1. **Подготовка данных**:
   - **Сбор данных**:
     - Собрать пары текст-изображение из `train_dataset.csv`.
     - Убедиться, что данные покрывают разнообразные случаи.
   - **Очистка данных**:
     - Удалить данные, нарушающие юридические ограничения (например, изображения детей).
     - Проверить и удалить дубликаты и некачественные данные.

2. **Агрегация оценок**:
   - **Краудсорсинговые оценки**:
     - Рассчитать средние значения и долю подтверждающих соответствие текстов и изображений.
   - **Экспертные оценки**:
     - Агрегировать оценки экспертов, используя метод голосования большинства.
   - **Объединение оценок**:
     - Разработать метод обобщения краудсорсинговых и экспертных оценок, например, взвешенное среднее, где экспертные оценки имеют больший вес.

3. **Обучение моделей**:
   - **Сиамская нейросеть**:
     - Разработка архитектуры сети с двумя идентичными подсетями для текста и изображений.
     - Подготовка положительных и отрицательных пар для обучения.
     - Обучение модели с использованием контрастивной потери.

4. **Векторизация**:
   - **Сиамская нейросеть**:
     - Преобразование текстов и изображений в векторные представления.

5. **Тестирование моделей**:
   - **Эмбеддинги тестовых изображений**:
     - Преобразовать все изображения из папки `test_images` в векторные представления с использованием обученных моделей.
   - **Запросы из `test_queries`**:
     - Выбрать 10 случайных запросов.
     - Преобразовать тексты запросов в векторные представления.
   - **Поиск подходящих изображений**:
     - **Сиамская сеть**: Использовать текстовый вектор для нахождения наименьшего расстояния до векторов изображений.
6. **Сравнение моделей**:
   - **Визуальная оценка**:
     - Визуально сравнить результаты поиска изображений для каждого запроса.
   - **Количественная оценка**:
     - Оценить модели на основе метрики качества (MSE для регрессионных задач).
   - **Выбор лучшей модели**:
     - На основе визуальной и количественной оценки выбрать наиболее эффективную модель.

7. **ВЫВОДЫ**
